<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HealthHub Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        /* --- Light Mode (Default: Colorful & Minimalist) --- */
        --bg-anim: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        --glass-bg: rgba(255, 255, 255, 0.85);
        --glass-border: rgba(255, 255, 255, 0.6);
        --text-main: #2d3748;
        --text-muted: #718096;
        --primary: #4e54c8;
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --accent-water: #00c6fb;
        --accent-med: #ff6b6b; 
        --input-bg: #f7fafc;
        --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        --radius: 24px;
    }

    [data-theme="dark"] {
        /* --- Dark Mode --- */
        --bg-anim: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #1a1a2e);
        --glass-bg: rgba(30, 30, 40, 0.9);
        --glass-border: rgba(255, 255, 255, 0.1);
        --text-main: #ffffff;
        --text-muted: #a0aec0;
        --primary: #764ba2;
        --input-bg: #2d2d3a;
        --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    }

    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background: var(--bg-anim);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        transition: color 0.3s ease;
    }

    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* --- Layout Container --- */
    .app-container {
        width: 100%;
        max-width: 440px;
        position: relative;
        perspective: 1000px;
    }

    /* --- Views (Login, Loading, App) --- */
    .view-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 35px 25px;
        width: 100%;
        display: none; /* Hidden by default */
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .view-card.active { display: block; opacity: 1; transform: translateY(0); }

    /* --- Typography --- */
    h1 { font-size: 1.8rem; font-weight: 700; margin: 0 0 5px 0; text-align: center; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    h2 { font-size: 1.4rem; margin: 0 0 15px 0; text-align: center; }
    p.subtitle { text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 25px; }

    /* --- Inputs --- */
    label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); margin-bottom: 8px; margin-left: 5px; }
    
    .input-wrapper { margin-bottom: 20px; }
    
    input, select {
        width: 100%;
        padding: 16px;
        border-radius: 16px;
        border: 2px solid transparent;
        background: var(--input-bg);
        color: var(--text-main);
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        transition: 0.3s;
    }
    input:focus { border-color: var(--primary); background: var(--glass-bg); box-shadow: 0 0 0 4px rgba(118, 75, 162, 0.1); }

    /* --- Special Date/Time Inputs --- */
    input[type="date"], input[type="time"] {
        appearance: none;
        position: relative;
        cursor: pointer;
    }
    /* Custom Time Input Styling */
    .time-input-container {
        position: relative;
    }
    .time-input-container input[type="time"] {
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        background: var(--input-bg);
        color: var(--primary);
        letter-spacing: 2px;
    }
    
    /* --- Buttons --- */
    .btn-main {
        width: 100%;
        padding: 18px;
        border: none;
        border-radius: 16px;
        background: var(--primary-gradient);
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 10px 20px -5px rgba(118, 75, 162, 0.4);
        transition: transform 0.2s;
    }
    .btn-main:active { transform: scale(0.97); }

    /* --- Loading Animation Screen --- */
    #loadingScreen { text-align: center; padding: 60px 20px; }
    .loader {
        width: 50px; height: 50px; border: 5px solid var(--input-bg);
        border-top: 5px solid var(--primary); border-radius: 50%;
        margin: 0 auto 20px; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* --- Dashboard Tabs --- */
    .tabs-nav {
        display: flex; background: var(--input-bg);
        padding: 6px; border-radius: 20px; margin-bottom: 25px;
    }
    .tab-btn {
        flex: 1; padding: 12px; border: none; background: transparent;
        border-radius: 14px; font-weight: 600; color: var(--text-muted);
        cursor: pointer; transition: 0.3s; font-family: 'Poppins', sans-serif;
    }
    .tab-btn.active { background: var(--glass-bg); color: var(--text-main); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .tab-btn.active[data-target="water"] { color: #00c6fb; }
    .tab-btn.active[data-target="med"] { color: #ff6b6b; }

    .tab-content { display: none; animation: fadeIn 0.5s ease; }
    .tab-content.active { display: block; }

    /* --- Water Tab Visuals --- */
    .water-ring { width: 160px; height: 160px; margin: 0 auto 20px; position: relative; }
    .water-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
    .water-ring circle { fill: none; stroke-width: 10; stroke-linecap: round; cx: 80; cy: 80; r: 70; }
    .ring-bg { stroke: var(--input-bg); }
    .ring-val { stroke: var(--accent-water); stroke-dasharray: 440; stroke-dashoffset: 440; transition: stroke-dashoffset 1s ease; }
    .ring-text {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        text-align: center;
    }
    .ring-text h3 { margin: 0; font-size: 2rem; color: var(--text-main); }
    .ring-text span { font-size: 0.8rem; color: var(--text-muted); }

    /* --- Medicine Tab Visuals --- */
    .clock-display {
        background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
        padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 25px;
        color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    [data-theme="dark"] .clock-display { background: linear-gradient(135deg, #4b2c34 0%, #6e3e4a 100%); color: #ffcccc; }
    .live-clock { font-size: 2.8rem; font-weight: 700; line-height: 1; }

    .day-selector { display: flex; justify-content: space-between; margin: 15px 0; }
    .day-selector label { margin:0; }
    .day-selector input { display: none; }
    .day-bubble {
        width: 36px; height: 36px; border-radius: 50%; background: var(--input-bg);
        display: flex; align-items: center; justify-content: center;
        font-size: 0.75rem; font-weight: 700; color: var(--text-muted);
        transition: 0.3s; cursor: pointer;
    }
    .day-selector input:checked + .day-bubble { background: var(--accent-med); color: white; transform: translateY(-3px); box-shadow: 0 5px 10px rgba(255, 107, 107, 0.4); }

    .med-list { margin-top: 20px; max-height: 250px; overflow-y: auto; }
    .med-item {
        background: var(--input-bg); padding: 15px; border-radius: 16px;
        margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
        border-left: 5px solid var(--accent-med); animation: slideIn 0.3s ease;
    }
    .del-btn { background: none; border: none; font-size: 1.2rem; color: #ff6b6b; cursor: pointer; }

    /* --- Alarm Modal --- */
    #alarmModal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 2000;
        display: none; align-items: center; justify-content: center;
        backdrop-filter: blur(5px);
    }
    .alarm-box {
        background: #fff; padding: 40px; border-radius: 30px; text-align: center; width: 90%; max-width: 320px;
        animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .alarm-icon { font-size: 4rem; display: block; margin-bottom: 10px; animation: bounce 1s infinite; }

    /* --- Theme Toggle --- */
    .theme-switch {
        position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
        background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);
        padding: 5px; border-radius: 50px; display: flex; gap: 5px; border: 1px solid rgba(255,255,255,0.3);
    }
    .theme-btn {
        width: 35px; height: 35px; border-radius: 50%; border: none;
        background: transparent; cursor: pointer; font-size: 1.2rem;
        display: flex; align-items: center; justify-content: center;
    }
    .theme-btn.active { background: #fff; color: #000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
    @keyframes slideIn { from{opacity:0; transform:translateX(-10px);} to{opacity:1; transform:translateX(0);} }
    @keyframes popUp { from{transform:scale(0.8);} to{transform:scale(1);} }
    @keyframes bounce { 0%, 100% {transform:translateY(0);} 50% {transform:translateY(-15px);} }
</style>
</head>
<body>

<div class="app-container">

    <div id="loginScreen" class="view-card active">
        <h1>HealthHub</h1>
        <p class="subtitle">Start your journey to better health</p>

        <div class="input-wrapper">
            <label>Name</label>
            <input type="text" id="u_name" placeholder="Enter your name">
        </div>

        <div class="input-wrapper">
            <label>Date of Birth</label>
            <input type="date" id="u_dob">
        </div>

        <button class="btn-main" onclick="handleLogin()">Continue</button>
    </div>

    <div id="loadingScreen" class="view-card">
        <div class="loader"></div>
        <h2 id="loadingText" style="color:var(--primary)">Analyzing...</h2>
        <p class="subtitle">Optimizing your health plan for <span id="userAgeDisplay"></span> years young.</p>
    </div>

    <div id="appScreen" class="view-card">
        <h2>üëã Hi, <span id="displayName" style="color:var(--primary)">User</span></h2>
        
        <div class="tabs-nav">
            <button class="tab-btn active" data-target="water" onclick="switchTab('water')">üíß Water</button>
            <button class="tab-btn" data-target="med" onclick="switchTab('med')">üíä Medicine</button>
        </div>

        <div id="waterTab" class="tab-content active">
            <div id="waterSetup">
                <p class="subtitle">Let's set your hydration goal</p>
                <div class="input-wrapper"><input type="number" id="w_weight" placeholder="Weight (kg)"></div>
                <div class="input-wrapper">
                    <select id="w_hours">
                        <option value="">Daily Active Hours</option>
                        <option value="6">6 Hours</option>
                        <option value="8">8 Hours</option>
                        <option value="12">12 Hours</option>
                    </select>
                </div>
                <div class="input-wrapper">
                    <select id="w_interval">
                        <option value="2">‚ö° 2 Min Demo (Test)</option>
                        <option value="30">Every 30 Mins</option>
                        <option value="60">Every 60 Mins</option>
                    </select>
                </div>
                <button class="btn-main" style="background: var(--accent-water); box-shadow: 0 10px 20px -5px rgba(0, 198, 251, 0.4);" onclick="WaterApp.start()">Start Tracking</button>
            </div>

            <div id="waterActive" style="display:none;">
                <div class="water-ring">
                    <svg><circle class="ring-bg"></circle><circle class="ring-val" id="w_circle"></circle></svg>
                    <div class="ring-text">
                        <h3 id="w_timer">00:00</h3>
                        <span>Next Sip</span>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:20px; text-align:center;">
                    <div><b style="font-size:1.2rem; display:block;" id="w_count">0</b> <span style="font-size:0.8rem; color:var(--text-muted)">Glasses</span></div>
                    <div><b style="font-size:1.2rem; display:block;" id="w_goal">0L</b> <span style="font-size:0.8rem; color:var(--text-muted)">Target</span></div>
                </div>
                <button class="btn-main" style="background: var(--accent-water);" onclick="WaterApp.drink()">ü•§ Log Water</button>
            </div>
        </div>

        <div id="medTab" class="tab-content">
            <div class="clock-display">
                <div class="live-clock" id="medClock">00:00</div>
                <div style="margin-top:5px; opacity:0.9; font-size:0.9rem;" id="nextDoseTxt">No upcoming doses</div>
            </div>

            <div class="input-wrapper">
                <label>Medicine Name</label>
                <input type="text" id="m_name" placeholder="e.g. Vitamin C">
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div class="input-wrapper time-input-container">
                    <label>Time</label>
                    <input type="time" id="m_time"> 
                </div>
                <div class="input-wrapper">
                    <label>Note (Voice)</label>
                    <input type="text" id="m_note" placeholder="Optional">
                </div>
            </div>

            <label style="margin-left:5px;">Select Days</label>
            <div class="day-selector">
                <label><input type="checkbox" value="1"><div class="day-bubble">M</div></label>
                <label><input type="checkbox" value="2"><div class="day-bubble">T</div></label>
                <label><input type="checkbox" value="3"><div class="day-bubble">W</div></label>
                <label><input type="checkbox" value="4"><div class="day-bubble">T</div></label>
                <label><input type="checkbox" value="5"><div class="day-bubble">F</div></label>
                <label><input type="checkbox" value="6"><div class="day-bubble">S</div></label>
                <label><input type="checkbox" value="0"><div class="day-bubble">S</div></label>
            </div>

            <button class="btn-main" style="background: #ff6b6b; box-shadow: 0 10px 20px -5px rgba(255, 107, 107, 0.4);" onclick="MedApp.add()">Add Reminder</button>

            <div class="med-list" id="medList"></div>
        </div>
    </div>

</div>

<div id="alarmModal">
    <div class="alarm-box">
        <span class="alarm-icon" id="alarmEmoji">‚è∞</span>
        <h2 id="alarmTitle" style="color:#333">Alert</h2>
        <p id="alarmMsg" style="color:#666; margin-bottom:25px;">Time for your task</p>
        <button class="btn-main" onclick="GlobalAudio.stop()">Dismiss</button>
    </div>
</div>

<div class="theme-switch">
    <button class="theme-btn active" onclick="setTheme('light')">‚òÄÔ∏è</button>
    <button class="theme-btn" onclick="setTheme('dark')">üåô</button>
</div>

<script>
    /* --- 1. GLOBAL AUDIO & THEME --- */
    const GlobalAudio = {
        ctx: null, interval: null,
        init: function() {
            if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        },
        play: function() {
            if(!this.ctx) this.init();
            if(this.ctx.state === 'suspended') this.ctx.resume();
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.connect(gain); gain.connect(this.ctx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, this.ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, this.ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.5, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.5);
            osc.start(); osc.stop(this.ctx.currentTime + 0.5);
        },
        trigger: function(title, msg, type) {
            document.getElementById('alarmModal').style.display = 'flex';
            document.getElementById('alarmTitle').innerText = title;
            document.getElementById('alarmMsg').innerText = msg;
            document.getElementById('alarmEmoji').innerText = type === 'water' ? 'üíß' : 'üíä';
            this.play();
            this.interval = setInterval(() => this.play(), 2000);
            if(navigator.vibrate) navigator.vibrate([300, 200, 300]);
        },
        stop: function() {
            clearInterval(this.interval);
            document.getElementById('alarmModal').style.display = 'none';
        }
    };

    function setTheme(mode) {
        document.body.setAttribute('data-theme', mode);
        document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
        event.target.closest('button').classList.add('active');
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tab === 'water' ? 'waterTab' : 'medTab').classList.add('active');
        document.querySelector(`.tab-btn[data-target="${tab}"]`).classList.add('active');
    }

    /* --- 2. LOGIN LOGIC --- */
    function handleLogin() {
        const name = document.getElementById('u_name').value;
        const dobVal = document.getElementById('u_dob').value;

        if(!name || !dobVal) return alert("Please fill in your details");

        // Calculate Age
        const dob = new Date(dobVal);
        const diff = Date.now() - dob.getTime();
        const ageDt = new Date(diff);
        const age = Math.abs(ageDt.getUTCFullYear() - 1970);

        // Update UI Text
        document.getElementById('displayName').innerText = name;
        document.getElementById('userAgeDisplay').innerText = age;

        // ANIMATION SEQUENCE
        document.getElementById('loginScreen').classList.remove('active');
        
        // Show Loading
        const loadScreen = document.getElementById('loadingScreen');
        loadScreen.classList.add('active');
        loadScreen.style.display = 'block'; // Ensure visibility for animation

        setTimeout(() => {
            document.getElementById('loadingText').innerText = "Make your health good...";
        }, 1500);

        setTimeout(() => {
            loadScreen.classList.remove('active');
            setTimeout(() => {
                loadScreen.style.display = 'none';
                document.getElementById('appScreen').classList.add('active');
                GlobalAudio.init(); // Warm up audio engine
                MedApp.init(); // Start Clock
            }, 500);
        }, 3000);
    }

    /* --- 3. WATER LOGIC --- */
    const WaterApp = {
        timer: null, maxGlasses: 0, currentGlass: 0, seconds: 0, totalSeconds: 0,
        start: function() {
            const w = document.getElementById('w_weight').value;
            const interval = document.getElementById('w_interval').value;
            if(!w || !interval) return alert("Please fill all water fields");

            const dailyL = (w * 0.033).toFixed(1);
            this.maxGlasses = Math.ceil((dailyL * 1000) / 250);
            this.totalSeconds = parseInt(interval) * 60;
            
            document.getElementById('w_goal').innerText = dailyL + 'L';
            document.getElementById('waterSetup').style.display = 'none';
            document.getElementById('waterActive').style.display = 'block';
            this.resetTimer();
        },
        resetTimer: function() {
            clearInterval(this.timer);
            this.seconds = this.totalSeconds;
            this.updateUI();
            this.timer = setInterval(() => {
                this.seconds--;
                this.updateUI();
                if(this.seconds <= 0) {
                    clearInterval(this.timer);
                    GlobalAudio.trigger("Hydrate", "Time to drink water!", "water");
                }
            }, 1000);
        },
        updateUI: function() {
            const min = Math.floor(this.seconds / 60).toString().padStart(2,'0');
            const sec = (this.seconds % 60).toString().padStart(2,'0');
            document.getElementById('w_timer').innerText = `${min}:${sec}`;
            
            // SVG Offset Logic (Circumference ~ 440)
            const offset = 440 - (440 * (this.seconds / this.totalSeconds));
            document.getElementById('w_circle').style.strokeDashoffset = offset;
        },
        drink: function() {
            this.currentGlass++;
            document.getElementById('w_count').innerText = this.currentGlass;
            GlobalAudio.stop();
            if(this.currentGlass >= this.maxGlasses) {
                alert("Daily Goal Reached! üéâ");
                clearInterval(this.timer);
            } else {
                this.resetTimer();
            }
        }
    };

    /* --- 4. MEDICINE LOGIC --- */
    const MedApp = {
        list: [],
        init: function() {
            setInterval(() => {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', {hour12: false, hour:'2-digit', minute:'2-digit'});
                document.getElementById('medClock').innerText = timeStr;
                
                if(now.getSeconds() === 0) {
                    const day = String(now.getDay());
                    this.list.forEach(m => {
                        if(m.time === timeStr && m.days.includes(day)) {
                            GlobalAudio.trigger("Medicine", `Take ${m.name}`, "med");
                            if(m.note && 'speechSynthesis' in window) {
                                speechSynthesis.speak(new SpeechSynthesisUtterance(m.note));
                            }
                        }
                    });
                }
            }, 1000);
        },
        add: function() {
            const name = document.getElementById('m_name').value;
            const time = document.getElementById('m_time').value;
            const note = document.getElementById('m_note').value;
            const days = Array.from(document.querySelectorAll('.day-selector input:checked')).map(cb=>cb.value);

            if(!name || !time || days.length === 0) return alert("Please fill Name, Time and Days");

            const med = { id: Date.now(), name, time, note, days };
            this.list.push(med);
            this.render();
            
            document.getElementById('m_name').value = '';
            document.getElementById('m_note').value = '';
            document.querySelectorAll('.day-selector input').forEach(i=>i.checked=false);
        },
        render: function() {
            const listEl = document.getElementById('medList');
            listEl.innerHTML = '';
            const dayMap = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
            
            this.list.sort((a,b)=>a.time.localeCompare(b.time)).forEach(m => {
                const dStr = m.days.length===7 ? "Daily" : m.days.map(d=>dayMap[d]).join(",");
                listEl.innerHTML += `
                    <div class="med-item">
                        <div>
                            <div style="font-weight:700">${m.name}</div>
                            <div style="font-size:0.85rem; color:var(--text-muted)">‚è∞ ${m.time} ‚Ä¢ ${dStr}</div>
                        </div>
                        <button class="del-btn" onclick="MedApp.del(${m.id})">√ó</button>
                    </div>`;
            });
            this.updateNext();
        },
        del: function(id) {
            this.list = this.list.filter(m => m.id !== id);
            this.render();
        },
        updateNext: function() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', {hour12:false,hour:'2-digit',minute:'2-digit'});
            const day = String(now.getDay());
            const next = this.list.find(m => m.days.includes(day) && m.time > timeStr);
            document.getElementById('nextDoseTxt').innerText = next ? `Next: ${next.name} at ${next.time}` : "No more doses today";
        }
    };
</script>
</body>
</html>
