<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#4f46e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>HealthHub Pro | Gold</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
    :root {
        /* LIGHT THEME */
        --primary: #6366f1;
        --accent: #ec4899;
        --bg-body: #f8fafc;
        --surface: #ffffff;
        --text-main: #0f172a;
        --text-sub: #64748b;
        --input-bg: #f1f5f9;
        --input-border: #e2e8f0;
        --shadow: 0 4px 20px rgba(0,0,0,0.05);
    }

    [data-theme="dark"] {
        /* DARK THEME */
        --bg-body: #0f172a;
        --surface: #1e293b;
        --text-main: #f8fafc;
        --text-sub: #94a3b8;
        --input-bg: #334155;
        --input-border: #475569;
        --shadow: 0 4px 20px rgba(0,0,0,0.4);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    body {
        margin: 0;
        font-family: 'Plus Jakarta Sans', sans-serif;
        background: var(--bg-body);
        color: var(--text-main);
        height: 100dvh; /* Mobile Viewport Fix */
        display: flex;
        justify-content: center;
        overflow: hidden;
        transition: background 0.3s ease;
    }

    /* --- LAYOUT CONTAINER --- */
    .app-shell {
        width: 100%;
        height: 100%;
        background: var(--surface);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }

    @media (min-width: 768px) {
        body { align-items: center; padding: 20px; }
        .app-shell {
            width: 400px;
            height: 90vh;
            max-height: 850px;
            border-radius: 32px;
            box-shadow: var(--shadow);
            border: 1px solid var(--input-border);
        }
    }

    /* --- HEADER --- */
    .header {
        padding: 16px 24px;
        padding-top: max(16px, env(safe-area-inset-top));
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--surface);
        border-bottom: 1px solid var(--input-border);
        z-index: 20;
    }
    .user-pill { display: flex; align-items: center; gap: 12px; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: var(--input-bg); border: 2px solid var(--primary); }
    .user-name { font-weight: 700; font-size: 1rem; }
    .theme-toggle {
        width: 40px; height: 40px; border-radius: 12px;
        background: var(--input-bg); border: none;
        color: var(--text-main); display: flex; align-items: center; justify-content: center;
        cursor: pointer; font-size: 1.2rem; transition: 0.2s;
    }

    /* --- CONTENT AREA --- */
    .content {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
        padding-bottom: 120px;
        scroll-behavior: smooth;
    }
    
    /* --- INPUTS & FORMS (FIXED LAYOUT) --- */
    .input-group { margin-bottom: 20px; }
    
    label {
        display: block;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-sub);
        margin-bottom: 8px;
        letter-spacing: 0.5px;
    }

    .input-box {
        width: 100%;
        padding: 16px;
        border-radius: 16px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-main); /* Ensures text is visible */
        font-family: inherit;
        font-size: 1rem;
        transition: 0.2s;
        -webkit-appearance: none; /* iOS Reset */
    }
    .input-box:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15); background: var(--surface); }

    /* Stacked Layout specifically to prevent overlap */
    .row-stack {
        display: flex;
        gap: 15px;
    }
    .row-stack > div { flex: 1; }

    /* --- BUTTONS --- */
    .btn-primary {
        width: 100%;
        padding: 18px;
        border-radius: 18px;
        border: none;
        background: linear-gradient(135deg, var(--primary), #4f46e5);
        color: white;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        box-shadow: 0 8px 20px -6px var(--primary);
        transition: transform 0.1s;
    }
    .btn-primary:active { transform: scale(0.98); }
    
    .btn-sec { background: transparent; border: 1px solid var(--input-border); color: var(--text-sub); box-shadow: none; }

    /* --- MEDICATION LIST --- */
    .med-card {
        background: var(--surface);
        border: 1px solid var(--input-border);
        padding: 16px;
        border-radius: 20px;
        margin-bottom: 12px;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: var(--shadow);
    }
    .med-icon {
        width: 48px; height: 48px; border-radius: 14px;
        background: rgba(99, 102, 241, 0.1); color: var(--primary);
        display: flex; align-items: center; justify-content: center; font-size: 1.25rem;
        margin-right: 15px;
    }
    .action-btn {
        width: 36px; height: 36px; border-radius: 10px;
        background: var(--input-bg); border: none;
        color: var(--text-sub); display: flex; align-items: center; justify-content: center;
        cursor: pointer; margin-left: 8px;
    }

    /* --- BOTTOM NAV --- */
    .nav-bar {
        position: absolute; bottom: 0; left: 0; right: 0;
        background: var(--surface);
        border-top: 1px solid var(--input-border);
        padding: 12px 24px;
        padding-bottom: max(12px, env(safe-area-inset-bottom));
        display: flex; justify-content: space-around;
        z-index: 50;
    }
    .nav-btn {
        background: none; border: none;
        display: flex; flex-direction: column; align-items: center; gap: 4px;
        color: var(--text-sub); opacity: 0.5; transition: 0.2s; cursor: pointer; flex: 1;
    }
    .nav-btn.active { opacity: 1; color: var(--primary); transform: translateY(-2px); }
    .nav-btn i { font-size: 1.5rem; }
    .nav-btn span { font-size: 0.7rem; font-weight: 700; }

    /* --- UTILS --- */
    .hidden { display: none; }
    .view-section { display: none; animation: fadeUp 0.3s ease-out; }
    .view-section.active { display: block; }
    @keyframes fadeUp { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

    /* Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
    .modal-box { background: var(--surface); width: 85%; max-width: 320px; padding: 25px; border-radius: 24px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.3); border: 1px solid var(--input-border); }

    /* Day Selector */
    .day-row { display: flex; justify-content: space-between; gap: 5px; margin-bottom: 20px; }
    .day-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--input-border); background: var(--input-bg); color: var(--text-sub); font-weight: 700; cursor: pointer; }
    .day-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* Water Ring */
    .water-container { position: relative; width: 180px; height: 180px; margin: 0 auto 30px; }
    svg { width: 100%; height: 100%; transform: rotate(-90deg); }
    circle { fill: none; stroke-width: 16; stroke-linecap: round; }
    .track { stroke: var(--input-bg); }
    .fill { stroke: #0ea5e9; stroke-dasharray: 500; stroke-dashoffset: 500; transition: 1s ease; }
</style>
</head>
<body>

<div class="app-shell">

    <div id="header_bar" class="header" style="display:none;">
        <div class="user-pill">
            <img id="head_avatar" src="" class="avatar">
            <div>
                <div style="font-size:0.75rem; color:var(--text-sub);">Hello,</div>
                <div class="user-name" id="head_name">User</div>
            </div>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
    </div>

    <div class="content">

        <div id="view_login" class="view-section active">
            <div style="text-align:center; padding: 30px 0;">
                <h1 style="color:var(--primary); font-size:2rem; margin-bottom:5px;">HealthHub Pro</h1>
                <p style="color:var(--text-sub);">Wellness & Audio Companion</p>
            </div>

            <div style="text-align:center; margin-bottom:20px;">
                <label for="u_img" style="width:100px; height:100px; border-radius:50%; background:var(--input-bg); border:2px dashed var(--text-sub); display:inline-flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden;">
                    <img id="img_preview" style="width:100%; height:100%; object-fit:cover; display:none;">
                    <i class="fas fa-camera" id="cam_icon" style="font-size:1.5rem; color:var(--text-sub);"></i>
                </label>
                <input type="file" id="u_img" hidden accept="image/*" onchange="loadImg(event)">
            </div>

            <div class="input-group">
                <label>Your Name</label>
                <input type="text" id="u_name" class="input-box" placeholder="John Doe">
            </div>

            <div class="row-stack input-group">
                <div>
                    <label>DOB</label>
                    <input type="date" id="u_dob" class="input-box" onchange="calcAge()">
                </div>
                <div>
                    <label>Age</label>
                    <input type="text" id="u_age" class="input-box" readonly style="text-align:center;">
                </div>
            </div>

            <div class="input-group">
                <label>Voice Language</label>
                <div style="display:flex; gap:10px;">
                    <select id="u_lang" class="input-box">
                        <option value="en">English (US)</option>
                        <option value="hi">Hindi (हिंदी)</option>
                        <option value="gu">Gujarati (ગુજરાતી)</option>
                    </select>
                    <button onclick="testAudio()" class="theme-toggle" style="width:54px; height:auto; border-radius:16px;"><i class="fas fa-volume-high"></i></button>
                </div>
            </div>

            <button class="btn-primary" onclick="doLogin()">Start Journey <i class="fas fa-arrow-right"></i></button>
            
            <p id="ios_alert" style="text-align:center; font-size:0.8rem; color:#f59e0b; margin-top:15px; display:none;">
                <i class="fab fa-apple"></i> iOS detected: Vibration is not supported by iPhones on the web. Audio will still work.
            </p>
        </div>

        <div id="view_water_setup" class="view-section">
            <h2 style="margin-bottom:20px;">Hydration Plan</h2>
            
            <div class="input-group">
                <label>Weight (KG)</label>
                <input type="number" id="w_weight" class="input-box" placeholder="e.g. 70">
            </div>

            <div class="row-stack input-group">
                <div>
                    <label>Wake Up</label>
                    <input type="time" id="w_wake" class="input-box" value="07:00">
                </div>
                <div>
                    <label>Bed Time</label>
                    <input type="time" id="w_bed" class="input-box" value="23:00">
                </div>
            </div>

            <div class="input-group">
                <label>Interval</label>
                <select id="w_int" class="input-box">
                    <option value="2">2 Mins (Demo)</option>
                    <option value="30">30 Mins</option>
                    <option value="60" selected>1 Hour</option>
                </select>
            </div>

            <button class="btn-primary" onclick="startWater()">Create Plan</button>
        </div>

        <div id="view_water" class="view-section">
            <h2 style="text-align:center; margin-bottom:30px;">Hydration</h2>
            
            <div class="water-container">
                <svg><circle class="track" cx="90" cy="90" r="80"></circle><circle class="fill" id="w_ring" cx="90" cy="90" r="80"></circle></svg>
                <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center;">
                    <div id="w_timer" style="font-size:2rem; font-weight:800; line-height:1;">00:00</div>
                    <div style="font-size:0.8rem; opacity:0.7;">Next Sip</div>
                </div>
            </div>

            <div class="row-stack" style="margin-bottom:25px;">
                <div style="background:var(--input-bg); padding:15px; border-radius:16px; text-align:center;">
                    <i class="fas fa-glass-water" style="color:#0ea5e9; font-size:1.5rem;"></i>
                    <div id="w_count" style="font-size:1.5rem; font-weight:700;">0</div>
                    <div style="font-size:0.7rem; color:var(--text-sub);">DRUNK</div>
                </div>
                <div style="background:var(--input-bg); padding:15px; border-radius:16px; text-align:center;">
                    <i class="fas fa-bullseye" style="color:var(--accent); font-size:1.5rem;"></i>
                    <div id="w_goal" style="font-size:1.5rem; font-weight:700;">0L</div>
                    <div style="font-size:0.7rem; color:var(--text-sub);">GOAL</div>
                </div>
            </div>

            <button class="btn-primary" onclick="drinkWater()">Drink Water (250ml)</button>
        </div>

        <div id="view_meds" class="view-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>Medications</h2>
                <button onclick="openMedForm()" class="btn-primary" style="width:40px; height:40px; padding:0; border-radius:12px;"><i class="fas fa-plus"></i></button>
            </div>
            <div id="med_list"></div>
        </div>

        <div id="view_med_form" class="view-section">
            <h2 id="form_title">Add Medication</h2>
            <input type="hidden" id="m_edit_id">

            <div class="input-group">
                <label>Medicine Name</label>
                <input type="text" id="m_name" class="input-box" placeholder="e.g. Aspirin">
            </div>

            <div class="input-group">
                <label>Frequency</label>
                <div style="display:flex; gap:10px;">
                    <button class="input-box dose-btn active" onclick="setDose(1)" style="text-align:center;">1x</button>
                    <button class="input-box dose-btn" onclick="setDose(2)" style="text-align:center;">2x</button>
                    <button class="input-box dose-btn" onclick="setDose(3)" style="text-align:center;">3x</button>
                </div>
            </div>

            <div class="input-group">
                <label>Time(s)</label>
                <div id="time_con" class="row-stack">
                    <input type="time" class="input-box time-inp">
                </div>
            </div>

            <div class="input-group">
                <label>Repeat Days</label>
                <div class="day-row">
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="0">S</button>
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="1">M</button>
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="2">T</button>
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="3">W</button>
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="4">T</button>
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="5">F</button>
                    <button class="day-btn active" onclick="this.classList.toggle('active')" data-d="6">S</button>
                </div>
            </div>

            <div class="input-group">
                <label>Voice Note</label>
                <input type="text" id="m_note" class="input-box" placeholder="Instructions...">
            </div>

            <div class="row-stack">
                <button class="btn-primary btn-sec" onclick="nav('meds')">Cancel</button>
                <button class="btn-primary" onclick="saveMed()">Save</button>
            </div>
        </div>

    </div>

    <div id="nav_bar" class="nav-bar" style="display:none;">
        <button class="nav-btn active" onclick="nav('water')" id="nav_water">
            <i class="fas fa-glass-water"></i> <span>Water</span>
        </button>
        <button class="nav-btn" onclick="nav('meds')" id="nav_meds">
            <i class="fas fa-pills"></i> <span>Meds</span>
        </button>
    </div>

</div>

<div class="modal-overlay" id="alert_modal">
    <div class="modal-box">
        <i class="fas fa-bell" style="font-size:3rem; color:var(--accent); margin-bottom:15px;"></i>
        <h2 id="alert_t">Alert</h2>
        <p id="alert_b" style="color:var(--text-sub); margin-bottom:20px;">Time up!</p>
        <button class="btn-primary" onclick="stopAlert()">Dismiss</button>
    </div>
</div>

<div class="modal-overlay" id="win_modal">
    <div class="modal-box">
        <i class="fas fa-trophy" style="font-size:3rem; color:#10b981; margin-bottom:15px;"></i>
        <h2>Goal Met!</h2>
        <p style="color:var(--text-sub); margin-bottom:20px;">You are fully hydrated!</p>
        <button class="btn-primary" onclick="document.getElementById('win_modal').style.display='none'">Awesome</button>
    </div>
</div>

<script>
    /* --- SYSTEM SETUP --- */
    let lang = 'en';
    let isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    
    // Check iOS
    if(isIOS) document.getElementById('ios_alert').style.display = 'block';

    /* --- AUDIO & VIBRATION ENGINE --- */
    const AudioSys = {
        ctx: null, interval: null,
        init: () => { 
            if(!AudioSys.ctx) AudioSys.ctx = new (window.AudioContext || window.webkitAudioContext)(); 
            // Silent resume for iOS
            if(AudioSys.ctx.state === 'suspended') AudioSys.ctx.resume();
        },
        tone: () => {
            if(AudioSys.ctx.state === 'suspended') AudioSys.ctx.resume();
            const o = AudioSys.ctx.createOscillator();
            const g = AudioSys.ctx.createGain();
            o.connect(g); g.connect(AudioSys.ctx.destination);
            o.frequency.setValueAtTime(600, AudioSys.ctx.currentTime);
            g.gain.setValueAtTime(0.5, AudioSys.ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, AudioSys.ctx.currentTime + 0.5);
            o.start(); o.stop(AudioSys.ctx.currentTime + 0.5);
        },
        speak: (txt) => {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(txt);
            const v = window.speechSynthesis.getVoices().find(vo => vo.lang.startsWith(document.getElementById('u_lang').value));
            if(v) u.voice = v;
            window.speechSynthesis.speak(u);
        },
        trigger: (title, body, speech) => {
            document.getElementById('alert_modal').style.display='flex';
            document.getElementById('alert_t').innerText = title;
            document.getElementById('alert_b').innerText = body;
            
            const act = () => {
                AudioSys.tone();
                if(speech) AudioSys.speak(speech);
                if(navigator.vibrate && !isIOS) navigator.vibrate([500, 200, 500]);
            };
            act();
            AudioSys.interval = setInterval(act, 4000);
            
            if('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body: body });
            }
        },
        stop: () => {
            clearInterval(AudioSys.interval);
            window.speechSynthesis.cancel();
            document.getElementById('alert_modal').style.display='none';
        }
    };
    
    /* --- CORE LOGIC --- */
    function toggleTheme() {
        const b = document.body;
        b.setAttribute('data-theme', b.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    function showView(id) {
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function nav(loc) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('nav_'+loc).classList.add('active');
        if(loc === 'water') {
            water.goal > 0 ? showView('view_water') : showView('view_water_setup');
        } else {
            showView('view_meds');
        }
    }

    /* --- LOGIN --- */
    function loadImg(e) {
        const r = new FileReader();
        r.onload = ev => {
            document.getElementById('img_preview').src = ev.target.result;
            document.getElementById('img_preview').style.display = 'block';
            document.getElementById('cam_icon').style.display = 'none';
            document.getElementById('head_avatar').src = ev.target.result;
        }
        r.readAsDataURL(e.target.files[0]);
    }

    function calcAge() {
        const d = document.getElementById('u_dob').value;
        if(d) document.getElementById('u_age').value = Math.abs(new Date(Date.now()-new Date(d).getTime()).getUTCFullYear()-1970);
    }

    function testAudio() {
        AudioSys.init();
        AudioSys.speak("Testing Audio System");
    }

    function doLogin() {
        const n = document.getElementById('u_name').value;
        if(!n) return alert("Enter Name");
        document.getElementById('head_name').innerText = n;
        document.getElementById('header_bar').style.display = 'flex';
        document.getElementById('nav_bar').style.display = 'flex';
        AudioSys.init();
        if('Notification' in window) Notification.requestPermission();
        nav('water');
    }

    /* --- WATER --- */
    let water = { t:null, left:0, max:0, goal:0, cnt:0 };
    
    function startWater() {
        const w = document.getElementById('w_weight').value;
        if(!w) return alert("Enter Weight");
        const l = (w * 0.033).toFixed(1);
        water.goal = Math.ceil((l*1000)/250);
        document.getElementById('w_goal').innerText = l + 'L';
        water.max = parseInt(document.getElementById('w_int').value) * 60;
        water.left = water.max;
        showView('view_water');
        runWater();
    }

    function runWater() {
        clearInterval(water.t);
        drawWater();
        water.t = setInterval(() => {
            water.left--;
            drawWater();
            if(water.left <= 0) {
                clearInterval(water.t);
                AudioSys.trigger("Hydrate", "Time to drink water!", "Drink Water");
            }
        }, 1000);
    }

    function drawWater() {
        const m = Math.floor(water.left / 60).toString().padStart(2,'0');
        const s = (water.left % 60).toString().padStart(2,'0');
        document.getElementById('w_timer').innerText = m+":"+s;
        document.getElementById('w_ring').style.strokeDashoffset = 500 - (500 * (water.left/water.max));
    }

    function drinkWater() {
        water.cnt++;
        document.getElementById('w_count').innerText = water.cnt;
        if(water.cnt >= water.goal) document.getElementById('win_modal').style.display = 'flex';
        stopAlert(); // Stop sound if playing
        water.left = water.max;
        runWater();
    }

    function stopAlert() { AudioSys.stop(); }

    /* --- MEDS (WITH EDITING) --- */
    let meds = [];

    function setDose(n) {
        document.querySelectorAll('.dose-btn').forEach((b,i) => b.classList.toggle('active', i+1===n));
        const c = document.getElementById('time_con'); c.innerHTML='';
        for(let i=0; i<n; i++) c.innerHTML += `<input type="time" class="input-box time-inp">`;
    }

    function openMedForm(id = null) {
        document.getElementById('form_title').innerText = id ? "Edit Medication" : "Add Medication";
        document.getElementById('m_edit_id').value = id || '';
        
        if(id) {
            const m = meds.find(x => x.id === id);
            document.getElementById('m_name').value = m.name;
            document.getElementById('m_note').value = m.note;
            setDose(m.times.length);
            setTimeout(() => {
                const inps = document.querySelectorAll('.time-inp');
                m.times.forEach((t, i) => inps[i].value = t);
            }, 50);
            document.querySelectorAll('.day-btn').forEach(b => {
                b.classList.toggle('active', m.days.includes(parseInt(b.dataset.d)));
            });
        } else {
            document.getElementById('m_name').value = '';
            document.getElementById('m_note').value = '';
            setDose(1);
            document.querySelectorAll('.day-btn').forEach(b => b.classList.add('active'));
        }
        showView('view_med_form');
    }

    function saveMed() {
        const name = document.getElementById('m_name').value;
        const times = Array.from(document.querySelectorAll('.time-inp')).map(i => i.value).filter(v => v);
        const days = Array.from(document.querySelectorAll('.day-btn.active')).map(b => parseInt(b.dataset.d));
        const id = document.getElementById('m_edit_id').value;

        if(!name || !times.length) return alert("Fill all details");

        if(id) meds = meds.filter(m => m.id != id); // Remove old if editing

        meds.push({ id: Date.now(), name, times, days, note: document.getElementById('m_note').value });
        renderMeds();
        nav('meds');
    }

    function renderMeds() {
        const c = document.getElementById('med_list');
        if(!meds.length) c.innerHTML = '<p style="text-align:center; opacity:0.6; margin-top:40px;">No medications.</p>';
        else c.innerHTML = meds.map(m => `
            <div class="med-card">
                <div class="med-left">
                    <div class="med-icon"><i class="fas fa-pills"></i></div>
                    <div>
                        <div style="font-weight:700;">${m.name}</div>
                        <div style="font-size:0.8rem; color:var(--primary);">${m.times.join(', ')}</div>
                    </div>
                </div>
                <div class="med-actions">
                    <button class="action-btn" onclick="openMedForm(${m.id})"><i class="fas fa-pencil"></i></button>
                    <button class="action-btn" onclick="deleteMed(${m.id})" style="color:#ef4444;"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        `).join('');
    }

    function deleteMed(id) { meds = meds.filter(m => m.id !== id); renderMeds(); }

    /* --- CLOCK LOOP --- */
    setInterval(() => {
        const d = new Date();
        if(d.getSeconds() === 0) {
            const t = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false});
            const day = d.getDay();
            meds.forEach(m => {
                if(m.days.includes(day) && m.times.includes(t)) {
                    AudioSys.trigger("Medication", `Take ${m.name}`, m.note || m.name);
                }
            });
        }
    }, 1000);

    // Init
    setDose(1);
</script>
</body>
</html>
