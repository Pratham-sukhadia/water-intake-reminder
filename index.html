<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HealthHub Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        /* --- Themes --- */
        --bg-anim: linear-gradient(-45deg, #f093fb, #f5576c, #4facfe, #00f2fe);
        --glass-bg: rgba(255, 255, 255, 0.9);
        --glass-border: rgba(255, 255, 255, 0.5);
        --text-main: #2d3748;
        --text-muted: #718096;
        --primary: #667eea;
        --primary-gradient: linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%);
        --btn-gradient: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
        --accent-water: #00c6fb;
        --accent-med: #ff9a9e; 
        --input-bg: #f8f9fa;
        --shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        --radius: 24px;
    }

    [data-theme="dark"] {
        --bg-anim: linear-gradient(-45deg, #243949, #517fa4, #243949, #141E30);
        --glass-bg: rgba(30, 30, 40, 0.95);
        --glass-border: rgba(255, 255, 255, 0.08);
        --text-main: #ffffff;
        --text-muted: #cbd5e0;
        --primary: #764ba2;
        --input-bg: #2d2d3a;
        --shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        --btn-gradient: linear-gradient(to right, #764ba2 0%, #667eea 100%);
    }

    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background: var(--bg-anim);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        transition: all 0.3s ease;
    }

    @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

    /* --- Container --- */
    .app-container {
        width: 100%;
        max-width: 440px;
        position: relative;
    }

    /* --- Illustrations --- */
    .illustration {
        width: 100%;
        height: 120px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin-bottom: 20px;
    }

    /* --- Views --- */
    .view-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 35px 25px;
        width: 100%;
        display: none;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .view-card.active { display: block; opacity: 1; transform: translateY(0); }

    /* --- Elements --- */
    h1 { font-size: 2rem; font-weight: 700; margin: 0; text-align: center; background: var(--btn-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    h2 { font-size: 1.5rem; margin: 0 0 10px 0; text-align: center; }
    p.subtitle { text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 25px; }

    label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); margin-bottom: 8px; margin-left: 5px; }
    
    input, select {
        width: 100%; padding: 16px; border-radius: 16px; border: 2px solid transparent;
        background: var(--input-bg); color: var(--text-main); font-family: inherit; font-size: 1rem;
        transition: 0.3s; margin-bottom: 15px;
    }
    input:focus, select:focus { border-color: #667eea; background: var(--glass-bg); box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }

    /* --- LIQUID GLASS BUTTON --- */
    .btn-main, .freq-btn {
        width: 100%;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        z-index: 1;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.4), inset 0 -4px 10px rgba(0, 0, 0, 0.05);
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
    }
    .btn-main::before, .freq-btn.active::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--btn-gradient); opacity: 0.85; z-index: -2; transition: 0.3s;
    }
    .btn-main::after, .freq-btn::after {
        content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transform: skewX(-20deg); transition: 0.5s; z-index: -1;
    }
    .btn-main:hover, .freq-btn:hover {
        transform: translateY(-3px) scale(1.02);
        border-color: rgba(255, 255, 255, 0.8);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25), inset 0 0 20px rgba(255, 255, 255, 0.4);
    }
    .btn-main:active { transform: scale(0.98); }
    .btn-main:hover::after { left: 100%; transition: 0.7s ease-in-out; }

    /* Frequency Specific Styles */
    .freq-selector { display: flex; gap: 10px; margin-bottom: 15px; }
    .freq-btn { 
        padding: 10px; font-size: 0.9rem; color: var(--text-muted); 
        background: var(--input-bg); /* Default unselected state */
    }
    .freq-btn.active { color: white; }
    /* Dynamic Inputs Grid */
    #timeInputsContainer { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    /* --- Language Dropdown --- */
    .lang-select-wrapper { position: absolute; top: 15px; right: 15px; z-index: 10; }
    .lang-select { padding: 5px 10px; border-radius: 20px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.5); font-size: 0.8rem; cursor: pointer; backdrop-filter: blur(5px); }

    /* --- Tabs --- */
    .tabs-nav { display: flex; background: var(--input-bg); padding: 5px; border-radius: 18px; margin-bottom: 25px; gap: 5px; }
    .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; border-radius: 14px; font-weight: 600; color: var(--text-muted); cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .tab-btn.active { background: #fff; color: var(--text-main); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    [data-theme="dark"] .tab-btn.active { background: #4a5568; color: #fff; }
    .tab-btn.active[data-target="water"] { color: #00c6fb; }
    .tab-btn.active[data-target="med"] { color: #ff9a9e; }
    .tab-content { display: none; animation: fadeIn 0.4s ease; }
    .tab-content.active { display: block; }

    /* --- Water Visuals --- */
    .water-ring { width: 160px; height: 160px; margin: 0 auto 20px; position: relative; }
    .water-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
    .water-ring circle { fill: none; stroke-width: 12; stroke-linecap: round; cx: 80; cy: 80; r: 70; }
    .ring-bg { stroke: var(--input-bg); }
    .ring-val { stroke: #00c6fb; stroke-dasharray: 440; stroke-dashoffset: 440; transition: stroke-dashoffset 1s linear; }
    .ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }

    /* --- Med Visuals --- */
    .clock-display { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 25px; color: white; box-shadow: 0 10px 20px rgba(161, 140, 209, 0.3); }
    .day-selector { display: flex; justify-content: space-between; margin: 15px 0; }
    .day-selector input { display: none; }
    .day-bubble { width: 38px; height: 38px; border-radius: 50%; background: var(--input-bg); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; color: var(--text-muted); cursor: pointer; transition: 0.3s; }
    .day-selector input:checked + .day-bubble { background: #ff9a9e; color: white; transform: scale(1.1); box-shadow: 0 5px 10px rgba(255, 154, 158, 0.4); }
    .med-list { margin-top: 20px; max-height: 250px; overflow-y: auto; }
    .med-item { background: var(--input-bg); padding: 15px; border-radius: 16px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ff9a9e; }

    /* --- Modal & Theme --- */
    #alarmModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .alarm-box { background: white; padding: 40px; border-radius: 30px; text-align: center; width: 90%; max-width: 320px; animation: popUp 0.5s; }
    .theme-switch { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 5px; border-radius: 50px; display: flex; gap: 5px; border: 1px solid rgba(255,255,255,0.3); }
    .theme-btn { width: 35px; height: 35px; border-radius: 50%; border: none; background: transparent; cursor: pointer; font-size: 1.2rem; }
    .theme-btn.active { background: #fff; color: #000; }
    .loader { width: 40px; height: 40px; border: 4px solid var(--input-bg); border-top: 4px solid #667eea; border-radius: 50%; margin: 0 auto 20px; animation: spin 1s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    @keyframes popUp { from{transform:scale(0.8);} to{transform:scale(1);} }
</style>
</head>
<body>

<div class="app-container">
    <div id="loginScreen" class="view-card active">
        <div class="lang-select-wrapper">
            <select class="lang-select" id="langSelect" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
            </select>
        </div>
        <div class="illustration" style="background-image: url('https://cdn-icons-png.flaticon.com/512/2966/2966327.png');"></div>
        <h1 data-key="app_title">HealthHub</h1>
        <p class="subtitle" data-key="app_subtitle">Your journey to better health starts here</p>
        <label data-key="lbl_name">Name</label>
        <input type="text" id="u_name" placeholder="Enter your name">
        <label data-key="lbl_dob">Date of Birth</label>
        <input type="date" id="u_dob">
        <button class="btn-main" onclick="handleLogin()" data-key="btn_continue">Continue</button>
    </div>

    <div id="loadingScreen" class="view-card">
        <div class="loader"></div>
        <h2 id="loadingText" style="color:var(--primary)" data-key="msg_analyzing">Analyzing...</h2>
        <p class="subtitle"><span data-key="msg_optimizing">Optimizing plan for</span> <span id="userAgeDisplay"></span> <span data-key="msg_years">years old</span>.</p>
    </div>

    <div id="appScreen" class="view-card">
        <h2>üëã <span data-key="hi">Hi</span>, <span id="displayName" style="color:#667eea">User</span></h2>
        
        <div class="tabs-nav">
            <button class="tab-btn active" data-target="water" onclick="switchTab('water')">
                üíß <span data-key="tab_water">Water</span>
            </button>
            <button class="tab-btn" data-target="med" onclick="switchTab('med')">
                üíä <span data-key="tab_med">Medicine</span>
            </button>
        </div>

        <div id="waterTab" class="tab-content active">
            <div id="waterSetup">
                <div class="illustration" style="height:80px; background-image: url('https://cdn-icons-png.flaticon.com/512/3105/3105807.png');"></div>
                <p class="subtitle" data-key="water_subtitle">Set your daily hydration goal</p>
                <label data-key="lbl_weight">Weight (kg)</label>
                <input type="number" id="w_weight">
                <label data-key="lbl_hours">Active Hours</label>
                <select id="w_hours">
                    <option value="6">6 Hours</option>
                    <option value="8">8 Hours</option>
                    <option value="12">12 Hours</option>
                </select>
                <label data-key="lbl_interval">Reminder Interval</label>
                <select id="w_interval">
                    <option value="2">‚ö° 2 Min (Demo)</option>
                    <option value="30">30 Mins</option>
                    <option value="60">60 Mins</option>
                </select>
                <button class="btn-main" style="--btn-gradient: linear-gradient(to right, #00c6fb, #005bea);" onclick="WaterApp.start()" data-key="btn_start_track">Start Tracking</button>
            </div>
            <div id="waterActive" style="display:none;">
                <div class="water-ring">
                    <svg><circle class="ring-bg"></circle><circle class="ring-val" id="w_circle"></circle></svg>
                    <div class="ring-text"><h3 id="w_timer">00:00</h3><span data-key="txt_next_sip">Next Sip</span></div>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:20px; text-align:center;">
                    <div><b style="font-size:1.2rem; display:block;" id="w_count">0</b> <span style="font-size:0.8rem; color:var(--text-muted)" data-key="txt_glasses">Glasses</span></div>
                    <div><b style="font-size:1.2rem; display:block;" id="w_goal">0L</b> <span style="font-size:0.8rem; color:var(--text-muted)" data-key="txt_target">Target</span></div>
                </div>
                <button class="btn-main" style="--btn-gradient: linear-gradient(to right, #00c6fb, #005bea);" onclick="WaterApp.drink()" data-key="btn_log_water">ü•§ Log Water</button>
            </div>
        </div>

        <div id="medTab" class="tab-content">
            <div class="clock-display">
                <div style="font-size:2.5rem; font-weight:700;" id="medClock">00:00</div>
                <div style="margin-top:5px; opacity:0.9; font-size:0.9rem;" id="nextDoseTxt" data-key="txt_no_dose">No upcoming doses</div>
            </div>

            <label data-key="lbl_med_name">Medicine Name</label>
            <input type="text" id="m_name" placeholder="e.g. Vitamin C">

            <label>How many times a day?</label>
            <div class="freq-selector">
                <button class="freq-btn active" onclick="MedApp.setFreq(1)">1</button>
                <button class="freq-btn" onclick="MedApp.setFreq(2)">2</button>
                <button class="freq-btn" onclick="MedApp.setFreq(3)">3</button>
                <button class="freq-btn" onclick="MedApp.setFreq(4)">4</button>
            </div>

            <label data-key="lbl_time">Set Times</label>
            <div id="timeInputsContainer">
                <input type="time" class="m-time-input">
            </div>

            <label data-key="lbl_note">Note</label>
            <input type="text" id="m_note" placeholder="Optional">

            <label data-key="lbl_days">Select Days</label>
            <div class="day-selector">
                <label><input type="checkbox" value="1"><div class="day-bubble">M</div></label>
                <label><input type="checkbox" value="2"><div class="day-bubble">T</div></label>
                <label><input type="checkbox" value="3"><div class="day-bubble">W</div></label>
                <label><input type="checkbox" value="4"><div class="day-bubble">T</div></label>
                <label><input type="checkbox" value="5"><div class="day-bubble">F</div></label>
                <label><input type="checkbox" value="6"><div class="day-bubble">S</div></label>
                <label><input type="checkbox" value="0"><div class="day-bubble">S</div></label>
            </div>

            <button class="btn-main" style="--btn-gradient: linear-gradient(to right, #ff9a9e, #fecfef); color:#d63384;" onclick="MedApp.add()" data-key="btn_add_rem">Add Reminder</button>
            <div class="med-list" id="medList"></div>
        </div>
    </div>
</div>

<div id="alarmModal">
    <div class="alarm-box">
        <div style="font-size:4rem; margin-bottom:10px;" id="alarmEmoji">‚è∞</div>
        <h2 id="alarmTitle" style="color:#333">Alert</h2>
        <p id="alarmMsg" style="color:#666; margin-bottom:25px;">Time for your task</p>
        <button class="btn-main" onclick="GlobalAudio.stop()" data-key="btn_dismiss">Dismiss</button>
    </div>
</div>

<div class="theme-switch">
    <button class="theme-btn active" onclick="setTheme('light')">‚òÄÔ∏è</button>
    <button class="theme-btn" onclick="setTheme('dark')">üåô</button>
</div>

<script>
    /* --- 1. LANGUAGE DATA --- */
    const langData = {
        en: {
            app_title: "HealthHub", app_subtitle: "Your journey to better health starts here",
            lbl_name: "Name", lbl_dob: "Date of Birth", btn_continue: "Continue",
            msg_analyzing: "Analyzing...", msg_optimizing: "Optimizing plan for", msg_years: "years old",
            hi: "Hi", tab_water: "Water", tab_med: "Medicine",
            water_subtitle: "Set your daily hydration goal", lbl_weight: "Weight (kg)", lbl_hours: "Active Hours",
            lbl_interval: "Reminder Interval", btn_start_track: "Start Tracking", txt_next_sip: "Next Sip",
            txt_glasses: "Glasses", txt_target: "Target", btn_log_water: "ü•§ Log Water",
            txt_no_dose: "No upcoming doses", lbl_med_name: "Medicine Name", lbl_time: "Set Times", lbl_note: "Note",
            lbl_days: "Select Days", btn_add_rem: "Add Reminder", btn_dismiss: "Dismiss",
            msg_hydrate: "Hydrate", msg_drink_water: "Time to drink water!", msg_med: "Medicine", msg_take: "Take",
            msg_goal_reached: "Daily Goal Reached! üéâ", msg_fill_all: "Please fill all fields",
            msg_health_good: "Make your health good..."
        },
        hi: {
            app_title: "‡§π‡•á‡§≤‡•ç‡§• ‡§π‡§¨", app_subtitle: "‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•Ä ‡§ì‡§∞ ‡§Ü‡§™‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ",
            lbl_name: "‡§®‡§æ‡§Æ", lbl_dob: "‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø", btn_continue: "‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç",
            msg_analyzing: "‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...", msg_optimizing: "‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§® ‡§∞‡§π‡•Ä ‡§π‡•à:", msg_years: "‡§µ‡§∞‡•ç‡§∑ ‡§Ü‡§Ø‡•Å",
            hi: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á", tab_water: "‡§™‡§æ‡§®‡•Ä", tab_med: "‡§¶‡§µ‡§æ",
            water_subtitle: "‡§Ö‡§™‡§®‡§æ ‡§¶‡•à‡§®‡§ø‡§ï ‡§ú‡§≤‡§Ø‡•ã‡§ú‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç", lbl_weight: "‡§µ‡§ú‡§® (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)", lbl_hours: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ò‡§Ç‡§ü‡•á",
            lbl_interval: "‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§Ö‡§Ç‡§§‡§∞‡§æ‡§≤", btn_start_track: "‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", txt_next_sip: "‡§Ö‡§ó‡§≤‡§æ ‡§ò‡•Ç‡§Ç‡§ü",
            txt_glasses: "‡§ó‡§ø‡§≤‡§æ‡§∏", txt_target: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø", btn_log_water: "ü•§ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Ç",
            txt_no_dose: "‡§ï‡•ã‡§à ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§¨‡§æ‡§ï‡•Ä ‡§®‡§π‡•Ä‡§Ç", lbl_med_name: "‡§¶‡§µ‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ", lbl_time: "‡§∏‡§Æ‡§Ø ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç", lbl_note: "‡§®‡•ã‡§ü",
            lbl_days: "‡§¶‡§ø‡§® ‡§ö‡•Å‡§®‡•á‡§Ç", btn_add_rem: "‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç", btn_dismiss: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
            msg_hydrate: "‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•á‡§ü", msg_drink_water: "‡§™‡§æ‡§®‡•Ä ‡§™‡•Ä‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø!", msg_med: "‡§¶‡§µ‡§æ", msg_take: "‡§≤‡•á‡§Ç",
            msg_goal_reached: "‡§¶‡•à‡§®‡§ø‡§ï ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü! üéâ", msg_fill_all: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç",
            msg_health_good: "‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•ã ‡§¨‡•á‡§π‡§§‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç..."
        },
        gu: {
            app_title: "‡™π‡´á‡™≤‡´ç‡™• ‡™π‡™¨", app_subtitle: "‡™§‡™Æ‡™æ‡™∞‡™æ ‡™∏‡´ç‡™µ‡™æ‡™∏‡´ç‡™•‡´ç‡™Ø ‡™∏‡´Å‡™ß‡™æ‡™∞‡™£‡™æ‡™®‡´Ä ‡™∂‡™∞‡´Ç‡™Ü‡™§ ‡™Ö‡™π‡´Ä‡™Ç‡™•‡´Ä",
            lbl_name: "‡™®‡™æ‡™Æ", lbl_dob: "‡™ú‡™®‡´ç‡™Æ ‡™§‡™æ‡™∞‡´Ä‡™ñ", btn_continue: "‡™ö‡™æ‡™≤‡´Å ‡™∞‡™æ‡™ñ‡´ã",
            msg_analyzing: "‡™µ‡™ø‡™∂‡´ç‡™≤‡´á‡™∑‡™£ ‡™ö‡™æ‡™≤‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á...", msg_optimizing: "‡™Ø‡´ã‡™ú‡™®‡™æ ‡™¨‡™®‡´Ä ‡™∞‡™π‡´Ä ‡™õ‡´á:", msg_years: "‡™µ‡™∞‡´ç‡™∑ ‡™â‡™Ç‡™Æ‡™∞",
            hi: "‡™®‡™Æ‡™∏‡´ç‡™§‡´á", tab_water: "‡™™‡™æ‡™£‡´Ä", tab_med: "‡™¶‡™µ‡™æ",
            water_subtitle: "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™¶‡´à‡™®‡™ø‡™ï ‡™™‡™æ‡™£‡´Ä‡™®‡´ã ‡™≤‡™ï‡´ç‡™∑‡´ç‡™Ø‡™æ‡™Ç‡™ï ‡™®‡™ï‡´ç‡™ï‡´Ä ‡™ï‡™∞‡´ã", lbl_weight: "‡™µ‡™ú‡™® (‡™ï‡™ø‡™ó‡´ç‡™∞‡™æ)", lbl_hours: "‡™∏‡™ï‡´ç‡™∞‡™ø‡™Ø ‡™ï‡™≤‡™æ‡™ï‡´ã",
            lbl_interval: "‡™∞‡™ø‡™Æ‡™æ‡™á‡™®‡´ç‡™°‡™∞ ‡™Ö‡™Ç‡™§‡™∞‡™æ‡™≤", btn_start_track: "‡™ü‡´ç‡™∞‡´á‡™ï‡™ø‡™Ç‡™ó ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã", txt_next_sip: "‡™Ü‡™ó‡™≥‡™®‡´ã ‡™ò‡´Ç‡™Ç‡™ü‡™°‡´ã",
            txt_glasses: "‡™ó‡´ç‡™≤‡™æ‡™∏", txt_target: "‡™≤‡™ï‡´ç‡™∑‡´ç‡™Ø", btn_log_water: "ü•§ ‡™™‡™æ‡™£‡´Ä ‡™≤‡´ã",
            txt_no_dose: "‡™ï‡´ã‡™à ‡™°‡´ã‡™ù ‡™¨‡™æ‡™ï‡´Ä ‡™®‡™•‡´Ä", lbl_med_name: "‡™¶‡™µ‡™æ‡™®‡´Å‡™Ç ‡™®‡™æ‡™Æ", lbl_time: "‡™∏‡™Æ‡™Ø ‡™∏‡´á‡™ü ‡™ï‡™∞‡´ã", lbl_note: "‡™®‡´ã‡™Ç‡™ß",
            lbl_days: "‡™¶‡™ø‡™µ‡™∏‡´ã ‡™™‡™∏‡™Ç‡™¶ ‡™ï‡™∞‡´ã", btn_add_rem: "‡™∞‡™ø‡™Æ‡™æ‡™á‡™®‡´ç‡™°‡™∞ ‡™â‡™Æ‡´á‡™∞‡´ã", btn_dismiss: "‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã",
            msg_hydrate: "‡™π‡™æ‡™á‡™°‡´ç‡™∞‡´á‡™ü", msg_drink_water: "‡™™‡™æ‡™£‡´Ä ‡™™‡´Ä‡™µ‡™æ‡™®‡´ã ‡™∏‡™Æ‡™Ø!", msg_med: "‡™¶‡™µ‡™æ", msg_take: "‡™≤‡´ã",
            msg_goal_reached: "‡™¶‡´à‡™®‡™ø‡™ï ‡™≤‡™ï‡´ç‡™∑‡´ç‡™Ø ‡™™‡´Ç‡™∞‡´ç‡™£! üéâ", msg_fill_all: "‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™¨‡™ß‡´Ä ‡™µ‡™ø‡™ó‡™§‡´ã ‡™≠‡™∞‡´ã",
            msg_health_good: "‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™∏‡´ç‡™µ‡™æ‡™∏‡´ç‡™•‡´ç‡™Ø ‡™∏‡™æ‡™∞‡´Å‡™Ç ‡™¨‡™®‡™æ‡™µ‡´ã..."
        }
    };

    let curLang = 'en';
    function changeLanguage() {
        curLang = document.getElementById('langSelect').value;
        const data = langData[curLang];
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if(data[key]) {
                if(el.tagName === 'INPUT') el.placeholder = data[key];
                else el.innerText = data[key];
            }
        });
        if(MedApp && MedApp.updateNext) MedApp.updateNext();
    }
    function getText(key) { return langData[curLang][key] || key; }

    /* --- CORE --- */
    const GlobalAudio = {
        ctx: null, interval: null,
        init: function() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
        play: function() {
            if(!this.ctx) this.init(); if(this.ctx.state === 'suspended') this.ctx.resume();
            const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
            o.connect(g); g.connect(this.ctx.destination);
            o.type='sine'; o.frequency.setValueAtTime(500, this.ctx.currentTime);
            g.gain.setValueAtTime(0.5, this.ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime+0.5);
            o.start(); o.stop(this.ctx.currentTime+0.5);
        },
        trigger: function(title, msg, type) {
            document.getElementById('alarmModal').style.display = 'flex';
            document.getElementById('alarmTitle').innerText = title;
            document.getElementById('alarmMsg').innerText = msg;
            const alertAction = () => { this.play(); if(navigator.vibrate) navigator.vibrate([500, 200, 500]); };
            alertAction(); this.interval = setInterval(alertAction, 2000);
        },
        stop: function() { clearInterval(this.interval); document.getElementById('alarmModal').style.display = 'none'; }
    };

    function setTheme(m) {
        document.body.setAttribute('data-theme', m);
        document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('active'));
        event.target.classList.add('active');
    }
    function switchTab(t) {
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));
        document.getElementById(t+'Tab').classList.add('active');
        document.querySelector(`.tab-btn[data-target="${t}"]`).classList.add('active');
    }
    function handleLogin() {
        const name = document.getElementById('u_name').value;
        const dobVal = document.getElementById('u_dob').value;
        if(!name || !dobVal) return alert(getText('msg_fill_all'));
        const age = Math.abs(new Date(Date.now() - new Date(dobVal).getTime()).getUTCFullYear() - 1970);
        document.getElementById('displayName').innerText = name;
        document.getElementById('userAgeDisplay').innerText = age;
        document.getElementById('loginScreen').classList.remove('active');
        const load = document.getElementById('loadingScreen');
        load.classList.add('active'); load.style.display='block';
        setTimeout(()=>{ document.getElementById('loadingText').innerText = getText('msg_health_good'); }, 1500);
        setTimeout(()=>{
            load.classList.remove('active');
            setTimeout(()=>{ load.style.display='none'; document.getElementById('appScreen').classList.add('active'); GlobalAudio.init(); MedApp.init(); }, 500);
        }, 3000);
    }

    /* --- WATER --- */
    const WaterApp = {
        timer:null, max:0, cur:0, sec:0, tot:0,
        start: function() {
            const w = document.getElementById('w_weight').value;
            const i = document.getElementById('w_interval').value;
            if(!w) return alert(getText('msg_fill_all'));
            const goal = (w*0.033).toFixed(1);
            this.max = Math.ceil((goal*1000)/250);
            this.tot = parseInt(i)*60;
            document.getElementById('w_goal').innerText = goal+'L';
            document.getElementById('waterSetup').style.display='none';
            document.getElementById('waterActive').style.display='block';
            this.reset();
        },
        reset: function() {
            clearInterval(this.timer); this.sec = this.tot; this.ui();
            this.timer = setInterval(()=>{
                this.sec--; this.ui();
                if(this.sec<=0) { clearInterval(this.timer); GlobalAudio.trigger(getText('msg_hydrate'), getText('msg_drink_water'), 'water'); }
            },1000);
        },
        ui: function() {
            document.getElementById('w_timer').innerText = `${Math.floor(this.sec/60).toString().padStart(2,'0')}:${(this.sec%60).toString().padStart(2,'0')}`;
            document.getElementById('w_circle').style.strokeDashoffset = 440 - (440 * (this.sec/this.tot));
        },
        drink: function() {
            this.cur++; document.getElementById('w_count').innerText = this.cur; GlobalAudio.stop();
            if(this.cur>=this.max) { alert(getText('msg_goal_reached')); clearInterval(this.timer); } else this.reset();
        }
    };

    /* --- MED --- */
    const MedApp = {
        list: [],
        currentFreq: 1,
        init: function() {
            setInterval(()=>{
                const now = new Date();
                const tStr = now.toLocaleTimeString('en-US', {hour12:false,hour:'2-digit',minute:'2-digit'});
                document.getElementById('medClock').innerText = tStr;
                if(now.getSeconds()===0) {
                    const d = String(now.getDay());
                    this.list.forEach(m=>{
                        // Check ALL times for this medicine
                        if(m.days.includes(d) && m.times.includes(tStr)) {
                            GlobalAudio.trigger(getText('msg_med'), `${getText('msg_take')} ${m.name}`, 'med');
                            if(m.note && 'speechSynthesis' in window) speechSynthesis.speak(new SpeechSynthesisUtterance(m.note));
                        }
                    });
                }
            },1000);
        },
        setFreq: function(n) {
            this.currentFreq = n;
            // Update UI
            document.querySelectorAll('.freq-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.freq-btn')[n-1].classList.add('active');
            
            // Re-render inputs
            const container = document.getElementById('timeInputsContainer');
            container.innerHTML = '';
            for(let i=0; i<n; i++) {
                const input = document.createElement('input');
                input.type = 'time';
                input.className = 'm-time-input';
                container.appendChild(input);
            }
        },
        add: function() {
            const n = document.getElementById('m_name').value;
            const note = document.getElementById('m_note').value;
            // Collect all times
            const timeInputs = document.querySelectorAll('.m-time-input');
            let times = [];
            timeInputs.forEach(i => { if(i.value) times.push(i.value); });
            
            const days = Array.from(document.querySelectorAll('.day-selector input:checked')).map(c=>c.value);
            
            if(!n || times.length === 0 || days.length===0) return alert(getText('msg_fill_all'));

            this.list.push({id:Date.now(), name:n, times:times, note:note, days:days});
            this.render();
            // Reset
            document.getElementById('m_name').value='';
            this.setFreq(1); // Reset frequency to 1
            document.querySelectorAll('.day-selector input').forEach(i=>i.checked=false);
        },
        render: function() {
            const el = document.getElementById('medList'); el.innerHTML='';
            const dayMap = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
            this.list.forEach(m=>{
                const ds = m.days.length===7 ? "Daily" : m.days.map(d=>dayMap[d]).join(",");
                // Display all times
                const tDisplay = m.times.sort().join(", ");
                el.innerHTML += `<div class="med-item"><div><b>${m.name}</b><br><small>‚è∞ ${tDisplay} ‚Ä¢ ${ds}</small></div><button class="del-btn" onclick="MedApp.del(${m.id})" style="color:red;background:none;border:none;">√ó</button></div>`;
            });
            this.updateNext();
        },
        del: function(id) { this.list = this.list.filter(m=>m.id!==id); this.render(); },
        updateNext: function() {
            const now = new Date();
            const tStr = now.toLocaleTimeString('en-US', {hour12:false,hour:'2-digit',minute:'2-digit'});
            const d = String(now.getDay());
            
            // Find absolute next dose among ALL medicines and ALL their times
            let candidates = [];
            this.list.forEach(m => {
                if(m.days.includes(d)) {
                    m.times.forEach(t => {
                        if(t > tStr) candidates.push({name: m.name, time: t});
                    });
                }
            });
            
            candidates.sort((a,b) => a.time.localeCompare(b.time));
            
            const next = candidates[0];
            document.getElementById('nextDoseTxt').innerText = next ? `Next: ${next.name} @ ${next.time}` : getText('txt_no_dose');
        }
    };
</script>
</body>
</html>
